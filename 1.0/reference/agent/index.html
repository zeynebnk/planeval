<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://swe-agent.com/latest/reference/agent/">
      
      
        <link rel="prev" href="../bundle_config/">
      
      
        <link rel="next" href="../env/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Agent class - SWE-agent documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M22%2012a10%2010%200%200%201-10%2010A10%2010%200%200%201%202%2012%2010%2010%200%200%201%2012%202a10%2010%200%200%201%2010%2010m-12%206%206-6-6-6-1.4%201.4%204.6%204.6-4.6%204.6z%22/%3E%3C/svg%3E');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
      <link rel="stylesheet" href="../../assets/navigation_cards.css">
    
      <link rel="stylesheet" href="../../assets/custom.css">
    
      <link rel="stylesheet" href="../../assets/mkdocstrings.css">
    
      <link rel="stylesheet" href="../../assets/image_theme.css">
    
      <link rel="stylesheet" href="../../assets/bubbles.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-SG2NC1GDRD"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-SG2NC1GDRD",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-SG2NC1GDRD",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-agent-class" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
              </button>
            
            
ðŸ“£ Check out <a href="https://mini-swe-agent.com">Mini-SWE-Agent</a>, an AI agent implemented in 100 lines that achieves 65% on SWE-bench verified!

          </div>
          
            <script>var el=document.querySelector("[data-md-component=announce]");if(el){var content=el.querySelector(".md-typeset");__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0)}</script>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SWE-agent documentation" class="md-header__button md-logo" aria-label="SWE-agent documentation" data-md-component="logo">
      
  <img src="../../assets/swe-agent.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SWE-agent documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Agent class
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="deep-orange" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/SWE-agent/SWE-agent" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    SWE-agent/SWE-agent
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../usage/" class="md-tabs__link">
          
  
  
    
  
  User Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SWE-agent documentation" class="md-nav__button md-logo" aria-label="SWE-agent documentation" data-md-component="logo">
      
  <img src="../../assets/swe-agent.svg" alt="logo">

    </a>
    SWE-agent documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/SWE-agent/SWE-agent" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
  </div>
  <div class="md-source__repository">
    SWE-agent/SWE-agent
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../.." class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../installation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Installation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/source/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    From source
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/codespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    In browser
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/keys/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models and keys
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/migration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    1.0 migration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/tips/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3">
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/hello_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello world
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/cl_tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command line basics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/coding_challenges/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solving coding challenges
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/inspector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Trajectory inspector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/batch_mode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch mode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/competitive_runs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Competitive runs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/adding_custom_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Adding custom tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/whats_next/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What's next?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../usage/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    User Guides
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    User Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../background/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Project overview
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Project overview
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../background/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../background/aci/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Command line interface
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/trajectories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Output files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5">
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../config/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Configuration
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Configuration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Config files
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/templates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/demonstrations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Demonstrations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../config/environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environments
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6">
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/contribute/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contribution guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dev/formatting_conflicts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Formatting conflicts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2">
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Run config
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Run config
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_single_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run single
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_batch_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Run batch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3">
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Instance config
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Instance config
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../problem_statements/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Problem statements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Repository
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_instances/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Batch instances
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Agent config
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agent config
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Model config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../template_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Templates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../history_processor_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    History processors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Action parsers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../env_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bundle_config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tool bundle config
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Classes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Classes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Agent class
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent class
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetryAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&nbsp;RetryAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.logger" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;logger
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.get_trajectory_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_trajectory_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.save_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DefaultAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&nbsp;DefaultAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.history_processors" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;history_processors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.max_requeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_requeries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.logger" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;logger
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.traj_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;traj_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.replay_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;replay_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_system_message_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_system_message_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_demonstrations_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_demonstrations_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_step_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_step_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_instance_template_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_instance_template_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.get_trajectory_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_trajectory_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.save_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.get_model_requery_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model_requery_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.attempt_autosubmission_after_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;attempt_autosubmission_after_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.handle_submission" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_submission
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.handle_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.forward_with_handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward_with_handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_step_to_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_step_to_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Environment class
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exceptions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RetryAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&nbsp;RetryAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.logger" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;logger
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.get_trajectory_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_trajectory_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.save_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.RetryAgent.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DefaultAgent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="&nbsp;DefaultAgent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.name" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;model
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;templates
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.tools" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;tools
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.history_processors" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;history_processors
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.max_requeries" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;max_requeries
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.logger" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;logger
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.traj_path" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;traj_path
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.info" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;info
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.replay_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;replay_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.messages" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-attribute"></code>&nbsp;messages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.from_config" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;from_config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_hook" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_hook
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_system_message_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_system_message_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_demonstrations_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_demonstrations_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_step_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_step_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_instance_template_to_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_instance_template_to_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.get_trajectory_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_trajectory_data
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.save_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.get_model_requery_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;get_model_requery_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.attempt_autosubmission_after_error" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;attempt_autosubmission_after_error
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.handle_submission" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_submission
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.handle_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;handle_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.forward_with_handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;forward_with_handling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.add_step_to_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_step_to_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.step" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sweagent.agent.agents.DefaultAgent.run" class="md-nav__link">
    <span class="md-ellipsis">
      
        <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;run
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                

                  


  
    <a href="https://github.com/SWE-agent/SWE-agent/edit/main/docs/reference/agent.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </a>
  
  


<h1 id="the-agent-class">The agent class</h1>
<p>This page documents the <code>Agent</code> class, which runs the main loop of the agent.
To learn about the configuration objects used to specify the behavior of an agent,
see the <a href="../agent_config/">agent configuration reference page</a>.</p>


<div class="doc doc-object doc-class">



<h2 id="sweagent.agent.agents.RetryAgent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">sweagent.agent.agents.RetryAgent</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">RetryAgent</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.agent.agents.RetryAgentConfig


  
      pydantic-model
  " href="../agent_config/#sweagent.agent.agents.RetryAgentConfig">RetryAgentConfig</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="sweagent.agent.agents.AbstractAgent">AbstractAgent</span></code></p>










                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RetryAgentConfig</span><span class="p">):</span>
    <span class="c1"># Always copy config to avoid shared state between different instances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_i_attempt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">"swea-agent"</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">"ðŸ¤ "</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="p">:</span> <span class="n">DefaultAgent</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_attempt_data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total_instance_attempt_stats</span> <span class="o">=</span> <span class="n">InstanceStats</span><span class="p">()</span>
<span class="w">    </span><span class="sd">"""Note that total_instance_attempt_stats only accumulates the states of the sub-agent,</span>
<span class="sd">    not the reviewer. Use self._total_instance_stats for the total stats.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span> <span class="o">=</span> <span class="n">CombinedAgentHook</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_traj_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">:</span> <span class="n">SWEEnv</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="p">:</span> <span class="n">ScoreRetryLoop</span> <span class="o">|</span> <span class="n">ChooserRetryLoop</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></tbody></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.RetryAgent.config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">config</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.RetryAgent(config).model_copy">model_copy</span></span><span class="p">(</span><span class="n"><span title="sweagent.agent.agents.RetryAgent(config).model_copy(deep)">deep</span></span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.RetryAgent.logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">logger</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">logger</span> <span class="o">=</span> <span class="n"><span title="sweagent.utils.log.get_logger">get_logger</span></span><span class="p">(</span><span class="s1">'swea-agent'</span><span class="p">,</span> <span class="n"><span title="sweagent.utils.log.get_logger(emoji)">emoji</span></span><span class="o">=</span><span class="s1">'ðŸ¤ '</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.from_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">from_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.agent.agents.RetryAgentConfig


  
      pydantic-model
  " href="../agent_config/#sweagent.agent.agents.RetryAgentConfig">RetryAgentConfig</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing_extensions.Self">Self</span></span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">RetryAgentConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.add_hook" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_hook</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_hook</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.hooks.abstract.AbstractAgentHook">AbstractAgentHook</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AbstractAgentHook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.setup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">setup</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">setup</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></span><span class="p">,</span> <span class="n">problem_statement</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatement">ProblemStatement</span></span> <span class="o">|</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatementConfig">ProblemStatementConfig</span></span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">=</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Setup the retry agent for a new problem instance.
This is mostly a bookkeeping step.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="n">SWEEnv</span><span class="p">,</span> <span class="n">problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="n">ProblemStatementConfig</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Setup the retry agent for a new problem instance.</span>
<span class="sd">    This is mostly a bookkeeping step.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total_instance_attempt_stats</span> <span class="o">=</span> <span class="n">InstanceStats</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span> <span class="o">=</span> <span class="n">problem_statement</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_traj_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">".traj"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">env</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span> <span class="o">=</span> <span class="n">get_retry_loop_from_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_loop</span><span class="p">,</span> <span class="n">problem_statement</span><span class="o">=</span><span class="n">problem_statement</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">step</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Step the agent of the current attempt.
Attempt autosubmit if an error occurs (though all errors should already be handled by the attempt agent).</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Step the agent of the current attempt.</span>
<span class="sd">    Attempt autosubmit if an error occurs (though all errors should already be handled by the attempt agent).</span>
<span class="sd">    """</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="c1"># Failsafe cost check, this should not actually happen, because the sub-agent should have already been</span>
    <span class="c1"># initialized with the correct cost limit to not exceed the total cost limit. Using factor of 1.1, because</span>
    <span class="c1"># sub-agent might only catch the cost limit after attempting.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_instance_stats</span><span class="o">.</span><span class="n">instance_cost</span> <span class="o">&gt;</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">retry_loop</span><span class="o">.</span><span class="n">cost_limit</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Total instance cost exceeded cost limit. This should not happen, please report this. Triggering autosubmit."</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">attempt_autosubmission_after_error</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">StepOutput</span><span class="p">())</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
    <span class="k">except</span> <span class="n">TotalCostLimitExceededError</span><span class="p">:</span>
        <span class="c1"># Need to make sure that this error causes everything to stop</span>
        <span class="k">raise</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Error in agent step: </span><span class="si">%s</span><span class="s2">. This really shouldn't happen, please report this. Triggering autosubmit."</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">attempt_autosubmission_after_error</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">StepOutput</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">step</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.get_trajectory_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_trajectory_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_trajectory_data</span><span class="p">(</span><span class="n">choose</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all data that we save in .traj files.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_trajectory_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Get all data that we save in .traj files."""</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"attempts"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attempt_data</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="n">choose</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">best_attempt_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">get_best</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">TotalCostLimitExceededError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error getting best attempt index: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Setting to 0."</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">best_attempt_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span> <span class="o">|=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attempt_data</span><span class="p">[</span><span class="n">best_attempt_idx</span><span class="p">])</span>  <span class="c1"># type: ignore</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">][</span><span class="s2">"best_attempt_idx"</span><span class="p">]</span> <span class="o">=</span> <span class="n">best_attempt_idx</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">][</span><span class="s2">"rloop_model_stats"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">review_model_stats</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
        <span class="c1"># Overwrite model stats with total stats</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">][</span><span class="s2">"model_stats"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_instance_stats</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="p">,</span> <span class="n">ChooserRetryLoop</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">][</span><span class="s2">"chooser"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">_chooser_output</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">_chooser_output</span> <span class="k">else</span> <span class="p">{}</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.save_trajectory" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">save_trajectory</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_trajectory</span><span class="p">(</span><span class="n">choose</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choose</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_data</span><span class="p">(</span><span class="n">choose</span><span class="o">=</span><span class="n">choose</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_traj_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.RetryAgent.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></span><span class="p">,</span> <span class="n">problem_statement</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatement">ProblemStatement</span></span> <span class="o">|</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatementConfig">ProblemStatementConfig</span></span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">=</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.AgentRunResult">AgentRunResult</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run the agent on a problem instance. This method contains the
main loop that repeatedly calls <code>self._step</code> until the problem is solved.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>env</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The environment to run the agent on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>problem_statement</code>
            </td>
            <td>
                  <code><span title="sweagent.agent.problem_statement.ProblemStatement">ProblemStatement</span> | <span title="sweagent.agent.problem_statement.ProblemStatementConfig">ProblemStatementConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The problem statement to run the agent on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the trajectory to</p>
              </div>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span>('.')</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">SWEEnv</span><span class="p">,</span>
    <span class="n">problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="n">ProblemStatementConfig</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"."</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentRunResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Run the agent on a problem instance. This method contains the</span>
<span class="sd">    main loop that repeatedly calls `self._step` until the problem is solved.</span>

<span class="sd">    Args:</span>
<span class="sd">        env: The environment to run the agent on.</span>
<span class="sd">        problem_statement: The problem statement to run the agent on.</span>
<span class="sd">        output_dir: Directory to save the trajectory to</span>
<span class="sd">    """</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">problem_statement</span><span class="o">=</span><span class="n">problem_statement</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

    <span class="c1"># Run action/observation loop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_run_start</span><span class="p">()</span>
    <span class="n">step_output</span> <span class="o">=</span> <span class="n">StepOutput</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_setup_agent</span><span class="p">()</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">step_output</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
        <span class="n">step_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_trajectory</span><span class="p">(</span><span class="n">choose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">step_output</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">on_submit</span><span class="p">(</span>
                <span class="n">ReviewSubmission</span><span class="p">(</span>
                    <span class="n">trajectory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span>
                    <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
                    <span class="n">model_stats</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="p">,</span> <span class="n">ScoreRetryLoop</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"review"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">reviews</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finalize_agent_run</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_trajectory</span><span class="p">(</span><span class="n">choose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rloop</span><span class="o">.</span><span class="n">retry</span><span class="p">():</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_next_attempt</span><span class="p">()</span>
                <span class="n">step_output</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">save_trajectory</span><span class="p">(</span><span class="n">choose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># call again after we finalized</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_run_done</span><span class="p">(</span><span class="n">trajectory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Trajectory saved to </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traj_path</span><span class="p">)</span>

    <span class="c1"># Here we want to return the "global" information (e.g., submission should</span>
    <span class="c1"># be the best submission instead of the last one, etc.), so we get it from the traj file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_data</span><span class="p">(</span><span class="n">choose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">AgentRunResult</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">],</span> <span class="n">trajectory</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"trajectory"</span><span class="p">])</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="sweagent.agent.agents.DefaultAgent" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">sweagent.agent.agents.DefaultAgent</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">DefaultAgent</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">templates</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.agent.agents.TemplateConfig


  
      pydantic-model
  " href="../template_config/#sweagent.agent.agents.TemplateConfig">TemplateConfig</a></span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="n"><span title="sweagent.tools.tools.ToolHandler">ToolHandler</span></span><span class="p">,</span> <span class="n">history_processors</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="sweagent.agent.history_processors.HistoryProcessor">HistoryProcessor</span></span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.models.AbstractModel">AbstractModel</span></span><span class="p">,</span> <span class="n">max_requeries</span><span class="p">:</span> <span class="n"><span title="int">int</span></span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">=</span> <span class="s1">'main'</span><span class="p">,</span> <span class="n">_catch_errors</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">_always_require_zero_exit_code</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">action_sampler_config</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.action_sampler.ActionSamplerConfig">ActionSamplerConfig</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="sweagent.agent.agents.AbstractAgent">AbstractAgent</span></code></p>



        <p>The agent handles the behaviour of the model and how it interacts with the environment.</p>
<p>To run the agent, either call <code>self.run</code> or <code>self.setup</code> and then <code>self.step</code> in a loop.</p>








                  <details class="mkdocstrings-source">
                    <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">templates</span><span class="p">:</span> <span class="n">TemplateConfig</span><span class="p">,</span>
    <span class="n">tools</span><span class="p">:</span> <span class="n">ToolHandler</span><span class="p">,</span>
    <span class="n">history_processors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">HistoryProcessor</span><span class="p">],</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">AbstractModel</span><span class="p">,</span>
    <span class="n">max_requeries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"main"</span><span class="p">,</span>
    <span class="n">_catch_errors</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">_always_require_zero_exit_code</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">action_sampler_config</span><span class="p">:</span> <span class="n">ActionSamplerConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">"""The agent handles the behaviour of the model and how it interacts with the environment.</span>

<span class="sd">    To run the agent, either call `self.run` or `self.setup` and then `self.step` in a loop.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_catch_errors</span> <span class="o">=</span> <span class="n">_catch_errors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_always_require_zero_exit_code</span> <span class="o">=</span> <span class="n">_always_require_zero_exit_code</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">templates</span> <span class="o">=</span> <span class="n">templates</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="o">=</span> <span class="n">tools</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">HumanThoughtModel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parse_function</span> <span class="o">=</span> <span class="n">ThoughtActionParser</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">HumanModel</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">parse_function</span> <span class="o">=</span> <span class="n">ActionOnlyParser</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history_processors</span> <span class="o">=</span> <span class="n">history_processors</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_requeries</span> <span class="o">=</span> <span class="n">max_requeries</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger</span><span class="p">(</span><span class="s2">"swea-agent"</span><span class="p">,</span> <span class="n">emoji</span><span class="o">=</span><span class="s2">"ðŸ¤ "</span><span class="p">)</span>
    <span class="c1"># Set in run method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">:</span> <span class="n">SWEEnv</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="n">ProblemStatementConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#: The following three attributes collect the information about how the agent</span>
    <span class="c1">#: solved the problem.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_trajectory</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">AgentInfo</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span> <span class="o">=</span> <span class="n">CombinedAgentHook</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_replay_config</span><span class="p">:</span> <span class="n">BaseModel</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<span class="w">    </span><span class="sd">"""This can be set to a RunSingleConfig from the Run instance whenever possible.</span>
<span class="sd">    It can be used to replay the agent's trajectory in an environment.</span>
<span class="sd">    """</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_action_sampler</span><span class="p">:</span> <span class="n">AbstractActionSampler</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">action_sampler_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_action_sampler</span> <span class="o">=</span> <span class="n">action_sampler_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>

    <span class="c1">#: Count how many timeout errors have occurred consecutively. Kills agent</span>
    <span class="c1">#: after 5 of them.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_n_consecutive_timeouts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total_execution_time</span> <span class="o">=</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></tbody></table></div>
                  </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.name" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">name</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(name)">name</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">model</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">model</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(model)">model</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.templates" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">templates</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">templates</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(templates)">templates</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.tools" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">tools</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">tools</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(tools)">tools</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.history_processors" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">history_processors</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">history_processors</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(history_processors)">history_processors</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.max_requeries" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">max_requeries</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">max_requeries</span> <span class="o">=</span> <span class="n"><span title="sweagent.agent.agents.DefaultAgent(max_requeries)">max_requeries</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.logger" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">logger</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">logger</span> <span class="o">=</span> <span class="n"><span title="sweagent.utils.log.get_logger">get_logger</span></span><span class="p">(</span><span class="s1">'swea-agent'</span><span class="p">,</span> <span class="n"><span title="sweagent.utils.log.get_logger(emoji)">emoji</span></span><span class="o">=</span><span class="s1">'ðŸ¤ '</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.traj_path" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">traj_path</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">traj_path</span><span class="p">:</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">history</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">history</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.info" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">info</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">info</span> <span class="o">=</span> <span class="n"><span title="sweagent.types.AgentInfo">AgentInfo</span></span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.trajectory" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">trajectory</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">trajectory</span><span class="p">:</span> <span class="n"><span title="sweagent.types.Trajectory">Trajectory</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.replay_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">replay_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">replay_config</span><span class="p">:</span> <span class="n"><span title="pydantic.BaseModel">BaseModel</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="sweagent.agent.agents.DefaultAgent.messages" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-attribute"></code>            <span class="doc doc-object-name doc-attribute-name">messages</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">messages</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the history of the agent for this attempt since the last reset,
processed through all history processors.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.from_config" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">from_config</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">from_config</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.agent.agents.DefaultAgentConfig


  
      pydantic-model
  " href="../agent_config/#sweagent.agent.agents.DefaultAgentConfig">DefaultAgentConfig</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="typing_extensions.Self">Self</span></span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">DefaultAgentConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
    <span class="c1"># To ensure that all models stay completely independent, we deepcopy the</span>
    <span class="c1"># model config, because it lives on as a property in the model, tools, etc.</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">get_model</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">config</span><span class="o">.</span><span class="n">tools</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">templates</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">templates</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">ToolHandler</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">tools</span><span class="p">),</span>
        <span class="n">history_processors</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">history_processors</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
        <span class="n">max_requeries</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">max_requeries</span><span class="p">,</span>
        <span class="n">action_sampler_config</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">action_sampler</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_hook" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_hook</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_hook</span><span class="p">(</span><span class="n">hook</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.hooks.abstract.AbstractAgentHook">AbstractAgentHook</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add hook to agent</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">:</span> <span class="n">AbstractAgentHook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add hook to agent"""</span>
    <span class="n">hook</span><span class="o">.</span><span class="n">on_init</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.setup" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">setup</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">setup</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></span><span class="p">,</span> <span class="n">problem_statement</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatement">ProblemStatement</span></span> <span class="o">|</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatementConfig">ProblemStatementConfig</span></span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">=</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Setup the agent for a new instance. This includes
formatting the system message and adding demonstrations to the history.</p>
<p>This method is called by <code>self.run</code>.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">SWEEnv</span><span class="p">,</span>
    <span class="n">problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="n">ProblemStatementConfig</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"."</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Setup the agent for a new instance. This includes</span>
<span class="sd">    formatting the system message and adding demonstrations to the history.</span>

<span class="sd">    This method is called by `self.run`.</span>
<span class="sd">    """</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># apply template configuration to multimodal problem statements</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">problem_statement</span><span class="p">,</span> <span class="s2">"type"</span><span class="p">)</span> <span class="ow">and</span> <span class="n">problem_statement</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">"swe_bench_multimodal"</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">sweagent.agent.problem_statement</span><span class="w"> </span><span class="kn">import</span> <span class="n">SWEBenchMultimodalProblemStatement</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">problem_statement</span><span class="p">,</span> <span class="n">SWEBenchMultimodalProblemStatement</span><span class="p">):</span>
            <span class="c1"># apply the global disable_image_processing setting if it's not explicitly set</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">problem_statement</span><span class="o">.</span><span class="n">disable_image_processing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">disable_image_processing</span><span class="p">:</span>
                <span class="n">problem_statement</span><span class="o">.</span><span class="n">disable_image_processing</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span> <span class="o">=</span> <span class="n">problem_statement</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="o">=</span> <span class="n">env</span>
    <span class="n">iid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="o">.</span><span class="n">id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Setting up agent for instance </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">iid</span><span class="p">)</span>

    <span class="c1"># Save/reset some attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">".traj"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Trajectory will be saved to </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_tools_installation_started</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">install</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_setup_attempt</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">AgentInfo</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"swe_agent_hash"</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_agent_commit_hash</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"swe_agent_version"</span><span class="p">]</span> <span class="o">=</span> <span class="n">__version__</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"swe_rex_version"</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_rex_version</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"swe_rex_hash"</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_rex_commit_hash</span><span class="p">()</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">set_env_variables</span><span class="p">({</span><span class="s2">"PROBLEM_STATEMENT"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="o">.</span><span class="n">get_problem_statement_for_env</span><span class="p">()})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_system_message_to_history</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_demonstrations_to_history</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_instance_template_to_history</span><span class="p">(</span><span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_setup_done</span><span class="p">()</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_system_message_to_history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_system_message_to_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_system_message_to_history</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add system message to history</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_system_message_to_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add system message to history"""</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">system_msg</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">system_template</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_format_dict</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"SYSTEM (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="si">{</span><span class="n">system_msg</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_append_history</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"system"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">system_msg</span><span class="p">,</span> <span class="s2">"agent"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">"message_type"</span><span class="p">:</span> <span class="s2">"system_prompt"</span><span class="p">}</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_demonstrations_to_history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_demonstrations_to_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_demonstrations_to_history</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add demonstrations to history</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_demonstrations_to_history</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add demonstrations to history"""</span>
    <span class="k">for</span> <span class="n">demonstration_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">demonstrations</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_demonstration_to_history</span><span class="p">(</span><span class="n">demonstration_path</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_step_to_history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_step_to_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_step_to_history</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Adds a step (command that was run and output) to the model history</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_step_to_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Adds a step (command that was run and output) to the model history"""</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_append_history</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">"role"</span><span class="p">:</span> <span class="s2">"assistant"</span><span class="p">,</span>
            <span class="s2">"content"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
            <span class="s2">"thought"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">thought</span><span class="p">,</span>
            <span class="s2">"action"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
            <span class="s2">"agent"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">"tool_calls"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">tool_calls</span><span class="p">,</span>
            <span class="s2">"message_type"</span><span class="p">:</span> <span class="s2">"action"</span><span class="p">,</span>
            <span class="s2">"thinking_blocks"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">thinking_blocks</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="n">elided_chars</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
        <span class="c1"># Show no output template if observation content was empty</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">next_step_no_output_template</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">max_observation_length</span><span class="p">:</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">next_step_truncated_observation_template</span><span class="p">]</span>
        <span class="n">elided_chars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">max_observation_length</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Show standard output template if there is observation content</span>
        <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">next_step_template</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_templated_messages_to_history</span><span class="p">(</span>
        <span class="n">templates</span><span class="p">,</span>
        <span class="n">observation</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
        <span class="n">elided_chars</span><span class="o">=</span><span class="n">elided_chars</span><span class="p">,</span>
        <span class="n">max_observation_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">max_observation_length</span><span class="p">,</span>
        <span class="n">tool_call_ids</span><span class="o">=</span><span class="n">step</span><span class="o">.</span><span class="n">tool_call_ids</span><span class="p">,</span>
        <span class="o">**</span><span class="n">step</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_instance_template_to_history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_instance_template_to_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_instance_template_to_history</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add observation to history, as well as the instance template or demonstrations if we're
at the start of a new attempt.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_instance_template_to_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Add observation to history, as well as the instance template or demonstrations if we're</span>
<span class="sd">    at the start of a new attempt.</span>
<span class="sd">    """</span>
    <span class="n">templates</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Determine observation template based on what prior observation was</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">"role"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"system"</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"is_demo"</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Show instance template if prev. obs. was initial system message</span>
    <span class="n">templates</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">instance_template</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">strategy_template</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">templates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">strategy_template</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_add_templated_messages_to_history</span><span class="p">(</span><span class="n">templates</span><span class="p">,</span> <span class="o">**</span><span class="n">state</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.get_trajectory_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_trajectory_data</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_trajectory_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all data that we save in .traj files.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_trajectory_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Get all data that we save in .traj files."""</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="c1"># The deepcopy here is important because else the</span>
    <span class="c1"># data["info"]["model_stats"] update will create havoc!</span>
    <span class="n">attempt_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">"trajectory"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span>
            <span class="s2">"history"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">,</span>
            <span class="s2">"info"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="n">attempt_data</span><span class="p">[</span><span class="s2">"replay_config"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replay_config</span><span class="o">.</span><span class="n">model_dump_json</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">replay_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">attempt_data</span><span class="p">[</span><span class="s2">"environment"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">name</span>
    <span class="k">return</span> <span class="n">attempt_data</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.save_trajectory" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">save_trajectory</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">save_trajectory</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save the trajectory to disk.
This includes the history, the environment state, and the model stats.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_trajectory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Save the trajectory to disk.</span>
<span class="sd">    This includes the history, the environment state, and the model stats.</span>
<span class="sd">    """</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_data</span><span class="p">()</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.get_model_requery_history" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">get_model_requery_history</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_model_requery_history</span><span class="p">(</span><span class="n">error_template</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="n"><span title="int">int</span></span> <span class="o">|</span> <span class="n"><span title="float">float</span></span> <span class="o">|</span> <span class="n"><span title="bool">bool</span></span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ask the model to correct after a hitting one of the following errors:</p>
<ol>
<li>Malformatted output (could not parse action)</li>
<li>Blocked action (command is on the blocklist)</li>
<li>Bash command syntax error</li>
</ol>
<p>At the time this function is called, the proposed action and observation are not part of the history
yet.</p>
<p>This function adds temporary history based on the error template and queries the model.
If the model is able to correct itself, the records of the mistakes will not be part of the history
(but they are saved in the trajectory).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>error_template</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error template</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model output</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="int">int</span> | <span title="float">float</span> | <span title="bool">bool</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>keyword arguments to be passed to the error template</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model output after requery</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_model_requery_history</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">error_template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">output</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""Ask the model to correct after a hitting one of the following errors:</span>

<span class="sd">    1. Malformatted output (could not parse action)</span>
<span class="sd">    2. Blocked action (command is on the blocklist)</span>
<span class="sd">    3. Bash command syntax error</span>

<span class="sd">    At the time this function is called, the proposed action and observation are not part of the history</span>
<span class="sd">    yet.</span>

<span class="sd">    This function adds temporary history based on the error template and queries the model.</span>
<span class="sd">    If the model is able to correct itself, the records of the mistakes will not be part of the history</span>
<span class="sd">    (but they are saved in the trajectory).</span>

<span class="sd">    Args:</span>
<span class="sd">        error_template: error template</span>
<span class="sd">        output: model output</span>
<span class="sd">        **kwargs: keyword arguments to be passed to the error template</span>

<span class="sd">    Returns:</span>
<span class="sd">        model output after requery</span>
<span class="sd">    """</span>
    <span class="n">format_dict</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_format_dict</span><span class="p">()}</span>
    <span class="n">error_template</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="n">error_template</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">format_dict</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">error_template</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">+</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"assistant"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">output</span><span class="p">,</span> <span class="s2">"agent"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">"message_type"</span><span class="p">:</span> <span class="s2">"assistant"</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">error_template</span><span class="p">,</span> <span class="s2">"agent"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">"message_type"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">},</span>
    <span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.attempt_autosubmission_after_error" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">attempt_autosubmission_after_error</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">attempt_autosubmission_after_error</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>For most exceptions, we attempt to still extract the patch and submit that.
This means we send the <code>submit</code> command to the runtime and parse the output.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">attempt_autosubmission_after_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""For most exceptions, we attempt to still extract the patch and submit that.</span>
<span class="sd">    This means we send the `submit` command to the runtime and parse the output.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Attempting autosubmission after error"</span><span class="p">)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">step</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">deployment</span><span class="o">.</span><span class="n">is_alive</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)):</span>
        <span class="c1"># The agent is dead. This is very bad. Maybe we can take a 'diff' that was saved</span>
        <span class="c1"># for a previous step? (if running with diff in tools)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Runtime is no longer alive"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">last_trajectory_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"No last trajectory step to extract patch from"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">step</span>
        <span class="k">if</span> <span class="s2">"diff"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">last_trajectory_step</span><span class="p">[</span><span class="s2">"state"</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"No diff in last trajectory step state, cannot autosubmit"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">step</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">last_trajectory_step</span><span class="p">[</span><span class="s2">"state"</span><span class="p">][</span><span class="s2">"diff"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Using diff from last trajectory step to autosubmit"</span><span class="p">)</span>
        <span class="n">step</span><span class="o">.</span><span class="n">submission</span> <span class="o">=</span> <span class="n">diff</span>
        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">submission</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="s2">"Environment died unexpectedly. Exited (autosubmitted)"</span>
            <span class="n">step</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"submitted (</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">)"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Diff from last traj step empty."</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">step</span>
    <span class="c1"># Let us manually run the submission command and collect the output</span>
    <span class="n">repo_name</span> <span class="o">=</span> <span class="s2">"/"</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">repo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">repo_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">repo</span><span class="o">.</span><span class="n">repo_name</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">submission_command</span> <span class="o">=</span> <span class="s2">"git add -A &amp;&amp; git diff --cached &gt; /root/model.patch"</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Executing submission command </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">submission_command</span><span class="p">,</span> <span class="n">repo_name</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="n">submission_command</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">repo_name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"Failed to execute submission command, got </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="c1"># There's still hope for the submission, because the `/root/model.patch` file might have been</span>
    <span class="c1"># generated by the state command</span>
    <span class="n">step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_submission</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">force_submission</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">submission</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Exiting with autosubmission"</span><span class="p">)</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="s2">"Exited (autosubmitted)"</span>
    <span class="k">return</span> <span class="n">step</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.handle_submission" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">handle_submission</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">handle_submission</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> <span class="n">force_submission</span><span class="p">:</span> <span class="n"><span title="bool">bool</span></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if there was a submission in the observation and handle it.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If specified, will use this rather than stepobservation</p>
              </div>
            </td>
            <td>
                  <code>''</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_submission</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, will always submit even if no submission is found</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>step</code></td>            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>step with submission and observation updated (if submission was found)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_submission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">observation</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">force_submission</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Check if there was a submission in the observation and handle it.</span>

<span class="sd">    Args:</span>
<span class="sd">        step:</span>
<span class="sd">        observation: If specified, will use this rather than stepobservation</span>
<span class="sd">        force_submission: If True, will always submit even if no submission is found</span>

<span class="sd">    Returns:</span>
<span class="sd">        step: step with submission and observation updated (if submission was found)</span>
<span class="sd">    """</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">is_submission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">check_for_submission_cmd</span><span class="p">(</span><span class="n">observation</span> <span class="ow">or</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_submission</span> <span class="ow">or</span> <span class="n">force_submission</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">submission</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">"/root/model.patch"</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">"utf-8"</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">"backslashreplace"</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Submission file not found, no submission was made"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">step</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">"Failed to read submission file, got </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">step</span>
        <span class="k">if</span> <span class="n">submission</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">submission</span> <span class="o">=</span> <span class="n">submission</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">submission</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">submission</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">step</span><span class="o">.</span><span class="n">exit_status</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">=</span> <span class="s2">"submitted"</span>
        <span class="k">elif</span> <span class="n">step</span><span class="o">.</span><span class="n">submission</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"submitted (</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">exit_status</span><span class="si">}</span><span class="s2">)"</span>
        <span class="n">step</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found submission: </span><span class="si">{</span><span class="n">submission</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">step</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.handle_action" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">handle_action</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">handle_action</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Runs an action proposed by the agent in the environment and returns the corresponding output.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>command to run in bash shell</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>output from model (only used for error handling)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>action_execution_output</code></td>            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>action execution output</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">handle_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Runs an action proposed by the agent in the environment and returns the corresponding output.</span>

<span class="sd">    Args:</span>
<span class="sd">        action: command to run in bash shell</span>
<span class="sd">        output: output from model (only used for error handling)</span>

<span class="sd">    Returns:</span>
<span class="sd">        action_execution_output: action execution output</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">should_block_action</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">_BlockedActionError</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"exit"</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Exiting agent"</span><span class="p">)</span>
        <span class="n">step</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="s2">"Exited"</span>
        <span class="n">step</span><span class="o">.</span><span class="n">exit_status</span> <span class="o">=</span> <span class="s2">"exit_command"</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">step</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>  <span class="c1"># for history</span>
        <span class="k">return</span> <span class="n">step</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_action_started</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="n">execution_t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="n">run_action</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">guard_multiline_input</span><span class="p">(</span><span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span>
            <span class="nb">input</span><span class="o">=</span><span class="n">run_action</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">execution_timeout</span><span class="p">,</span>
            <span class="n">check</span><span class="o">=</span><span class="s2">"raise"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_always_require_zero_exit_code</span> <span class="k">else</span> <span class="s2">"ignore"</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">CommandTimeoutError</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_consecutive_timeouts</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_n_consecutive_timeouts</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">max_consecutive_execution_timeouts</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">"Exiting agent due to too many consecutive execution timeouts"</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">execution_t0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_execution_time</span> <span class="o">+=</span> <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span>
            <span class="k">raise</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="o">.</span><span class="n">interrupt_session</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">"Failed to interrupt session after command timeout: </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">execution_t0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_total_execution_time</span> <span class="o">+=</span> <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span>
            <span class="k">raise</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">Template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">command_cancelled_timeout_template</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">(</span>
            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_format_dict</span><span class="p">(),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">execution_timeout</span><span class="p">,</span>
            <span class="n">command</span><span class="o">=</span><span class="n">run_action</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_n_consecutive_timeouts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">execution_t0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_total_execution_time</span> <span class="o">+=</span> <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_action_executed</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="n">step</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">get_state</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_env</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">RETRY_WITH_OUTPUT_TOKEN</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">:</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">RETRY_WITH_OUTPUT_TOKEN</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">_RetryWithOutput</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">RETRY_WITHOUT_OUTPUT_TOKEN</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">:</span>
        <span class="n">step</span><span class="o">.</span><span class="n">observation</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">RETRY_WITHOUT_OUTPUT_TOKEN</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">_RetryWithoutOutput</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">EXIT_FORFEIT_TOKEN</span> <span class="ow">in</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_ExitForfeit</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_submission</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.forward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">forward</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">forward</span><span class="p">(</span><span class="n">history</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Forward the model without handling errors.</p>
<p>All exceptions raised will contain the <code>StepOutput</code> object
with some of the attributes set.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>history to query the model with</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>step_output</code></td>            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>step output</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Forward the model without handling errors.</span>

<span class="sd">    All exceptions raised will contain the `StepOutput` object</span>
<span class="sd">    with some of the attributes set.</span>

<span class="sd">    Args:</span>
<span class="sd">        history: history to query the model with</span>

<span class="sd">    Returns:</span>
<span class="sd">        step_output: step output</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_execution_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">total_execution_timeout</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">_TotalExecutionTimeExceeded</span><span class="p">()</span>

    <span class="c1"># we continuously add actions, output etc. to the step object</span>
    <span class="c1"># because some of the specific exception handling requires some of these</span>
    <span class="c1"># attributes (e.g., if we want to requery the model for a bash syntax error, we</span>
    <span class="c1"># need to have the previous model output to format the requery template)</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">StepOutput</span><span class="p">()</span>
    <span class="n">step</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Forward model and get actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_model_query</span><span class="p">(</span><span class="n">messages</span><span class="o">=</span><span class="n">history</span><span class="p">,</span> <span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="c1"># todo: Add all options to the extra info</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_sampler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">best</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_action_sampler</span><span class="o">.</span><span class="n">get_action</span><span class="p">(</span>
                <span class="n">problem_statement</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_problem_statement</span><span class="p">,</span>
                <span class="n">trajectory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span>
                <span class="n">history</span><span class="o">=</span><span class="n">history</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">best</span><span class="o">.</span><span class="n">completion</span>
            <span class="c1"># todo: Handle history and trajectory</span>
            <span class="n">step</span><span class="o">.</span><span class="n">extra_info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">best</span><span class="o">.</span><span class="n">extra_info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="n">step</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">"message"</span><span class="p">]</span>
        <span class="c1"># todo: Can't I override the parser in __init__?</span>
        <span class="n">step</span><span class="o">.</span><span class="n">thought</span><span class="p">,</span> <span class="n">step</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">parse_actions</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">step</span><span class="o">.</span><span class="n">thinking_blocks</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"thinking_blocks"</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"tool_calls"</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span><span class="o">.</span><span class="n">tool_call_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">call</span><span class="p">[</span><span class="s2">"id"</span><span class="p">]</span> <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s2">"tool_calls"</span><span class="p">]]</span>
            <span class="n">step</span><span class="o">.</span><span class="n">tool_calls</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="s2">"tool_calls"</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"ðŸ’­ THOUGHT</span><span class="se">\n</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">thought</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">ðŸŽ¬ ACTION</span><span class="se">\n</span><span class="si">{</span><span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_actions_generated</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_action</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">step</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="n">step</span><span class="o">.</span><span class="n">thought</span> <span class="o">==</span> <span class="s2">""</span><span class="p">:</span>
            <span class="c1"># Probably the parsing failed/no action included. Let's still fill in thought</span>
            <span class="c1"># so that trajectory viewers have something to show us for this step.</span>
            <span class="n">step</span><span class="o">.</span><span class="n">thought</span> <span class="o">=</span> <span class="n">step</span><span class="o">.</span><span class="n">output</span>
        <span class="c1"># Attach the step object to the exception</span>
        <span class="n">e</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>  <span class="c1"># type: ignore</span>
        <span class="k">raise</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.forward_with_handling" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">forward_with_handling</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">forward_with_handling</span><span class="p">(</span><span class="n">history</span><span class="p">:</span> <span class="n"><span title="list">list</span></span><span class="p">[</span><span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Forward the model and handle errors, requerying the model if we can.
For example, if the model outputs a bash command that has syntax errors,
we will not execute it but requery the model for a corrected command.</p>
<p>Note: This will update the trajectory, but not the history.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>[<span title="str">str</span>, <span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>history to forward</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>step_output</code></td>            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>step output</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">forward_with_handling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Forward the model and handle errors, requerying the model if we can.</span>
<span class="sd">    For example, if the model outputs a bash command that has syntax errors,</span>
<span class="sd">    we will not execute it but requery the model for a corrected command.</span>

<span class="sd">    Note: This will update the trajectory, but not the history.</span>

<span class="sd">    Args:</span>
<span class="sd">        history: history to forward</span>

<span class="sd">    Returns:</span>
<span class="sd">        step_output: step output</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_error_with_autosubmission</span><span class="p">(</span><span class="n">exit_status</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Attempts to autosubmit (extract patch from the environment) and stops the loop."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attempt_autosubmission_after_error</span><span class="p">(</span>
            <span class="n">StepOutput</span><span class="p">(</span>
                <span class="n">thought</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="n">exit_status</span><span class="o">=</span><span class="n">exit_status</span><span class="p">,</span>
                <span class="n">output</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="n">done</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_error_with_retry</span><span class="p">(</span><span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n_requeries</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Requeries the model if the error is a format/blocklist/bash syntax error."""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Requerying model after </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2">th requery)"</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">n_requeries</span><span class="p">)</span>
        <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="s2">"step"</span><span class="p">,</span> <span class="n">StepOutput</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_step_to_trajectory</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">exception_message</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="s2">"message"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">exception_message</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">exception_message</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_requery_history</span><span class="p">(</span>
            <span class="n">error_template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span>
            <span class="o">**</span><span class="n">step</span><span class="o">.</span><span class="n">to_template_format_dict</span><span class="p">(),</span>
            <span class="o">**</span><span class="nb">getattr</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="s2">"extra_info"</span><span class="p">,</span> <span class="p">{}),</span>
            <span class="n">exception_message</span><span class="o">=</span><span class="n">exception_message</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">n_format_fails</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">n_format_fails</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_requeries</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">history</span><span class="p">)</span>

        <span class="c1"># Errors that are raised</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">raise</span>

        <span class="c1"># Errors that cause requery</span>

        <span class="k">except</span> <span class="n">FormatError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">n_format_fails</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">handle_error_with_retry</span><span class="p">(</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">format_error_template</span><span class="p">,</span> <span class="n">n_requeries</span><span class="o">=</span><span class="n">n_format_fails</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_BlockedActionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">n_format_fails</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">handle_error_with_retry</span><span class="p">(</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tools</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">blocklist_error_template</span><span class="p">,</span> <span class="n">n_requeries</span><span class="o">=</span><span class="n">n_format_fails</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ContentPolicyViolationError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"Content policy violation, trying to resample"</span><span class="p">)</span>
            <span class="n">n_format_fails</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Try if simply resampling helps here</span>
            <span class="k">pass</span>
        <span class="k">except</span> <span class="n">BashIncorrectSyntaxError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">n_format_fails</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">handle_error_with_retry</span><span class="p">(</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">shell_check_error_template</span><span class="p">,</span>
                <span class="n">n_requeries</span><span class="o">=</span><span class="n">n_format_fails</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_RetryWithOutput</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">history</span> <span class="o">=</span> <span class="n">handle_error_with_retry</span><span class="p">(</span>
                <span class="n">exception</span><span class="o">=</span><span class="n">e</span><span class="p">,</span>
                <span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">templates</span><span class="o">.</span><span class="n">next_step_template</span><span class="p">,</span>
                <span class="n">n_requeries</span><span class="o">=</span><span class="n">n_format_fails</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">_RetryWithoutOutput</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1"># Requery with the same template as the last step</span>

        <span class="c1"># Errors that cause exit</span>

        <span class="k">except</span> <span class="n">_ExitForfeit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Exiting due to forfeit"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_forfeit"</span><span class="p">,</span>
                <span class="s2">"Exiting due to forfeit"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">_TotalExecutionTimeExceeded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">"Exiting due to total execution time exceeded"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_total_execution_time"</span><span class="p">,</span>
                <span class="s2">"Exit due to total execution time exceeded"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">CommandTimeoutError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">"Exiting due to multiple consecutive command timeouts"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_command_timeout"</span><span class="p">,</span>
                <span class="s2">"Exit due to multiple consecutive command timeouts"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">ContextWindowExceededError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_context"</span><span class="p">,</span>
                <span class="s2">"Exit due to context window"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">TotalCostLimitExceededError</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">CostLimitExceededError</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_cost"</span><span class="p">,</span>
                <span class="s2">"Exit due to cost limit"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">RetryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Exiting due to retry error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_api"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"Exit due to retry error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">SwerexException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Exiting due to environment error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_environment_error"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"Exit due to environment error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Exiting due to runtime error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_error"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"Exit due to runtime error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Exiting due to unknown error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
                <span class="s2">"exit_error"</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">"Exit due to unknown error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span>
        <span class="s2">"Exit due to repeated format/blocklist/bash syntax errors"</span><span class="p">,</span>
        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">handle_error_with_autosubmission</span><span class="p">(</span>
        <span class="s2">"exit_format"</span><span class="p">,</span>
        <span class="s2">"Exit due to repeated format/blocklist/bash syntax errors"</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.add_step_to_trajectory" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_step_to_trajectory</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_step_to_trajectory</span><span class="p">(</span><span class="n">step</span><span class="p">:</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_step_to_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="n">StepOutput</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">trajectory_step</span> <span class="o">=</span> <span class="n">TrajectoryStep</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">"action"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
            <span class="s2">"observation"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">observation</span><span class="p">,</span>
            <span class="s2">"response"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">output</span><span class="p">,</span>
            <span class="s2">"thought"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">thought</span><span class="p">,</span>
            <span class="s2">"execution_time"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">execution_time</span><span class="p">,</span>
            <span class="s2">"state"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s2">"query"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">query</span><span class="p">,</span>
            <span class="s2">"extra_info"</span><span class="p">:</span> <span class="n">step</span><span class="o">.</span><span class="n">extra_info</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trajectory_step</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.step" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">step</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">step</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.StepOutput">StepOutput</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run a step of the agent. This is a wrapper around <code>self.forward_with_handling</code>
with additional bookkeeping:</p>
<ol>
<li>Update message history with performed action and observation</li>
<li>Update trajectory with the final executed result</li>
<li>Update the info dictionary</li>
</ol>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>step_output</code></td>            <td>
                  <code><span title="sweagent.types.StepOutput">StepOutput</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>step output (same as the output of <code>self.forward_with_handling</code>)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StepOutput</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Run a step of the agent. This is a wrapper around `self.forward_with_handling`</span>
<span class="sd">    with additional bookkeeping:</span>

<span class="sd">    1. Update message history with performed action and observation</span>
<span class="sd">    2. Update trajectory with the final executed result</span>
<span class="sd">    3. Update the info dictionary</span>

<span class="sd">    Returns:</span>
<span class="sd">        step_output: step output (same as the output of `self.forward_with_handling`)</span>
<span class="sd">    """</span>

    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_step_start</span><span class="p">()</span>

    <span class="n">n_step</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"="</span> <span class="o">*</span> <span class="mi">25</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">" STEP </span><span class="si">{</span><span class="n">n_step</span><span class="si">}</span><span class="s2"> "</span> <span class="o">+</span> <span class="s2">"="</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
    <span class="n">step_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward_with_handling</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">add_step_to_history</span><span class="p">(</span><span class="n">step_output</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"submission"</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_output</span><span class="o">.</span><span class="n">submission</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"exit_status"</span><span class="p">]</span> <span class="o">=</span> <span class="n">step_output</span><span class="o">.</span><span class="n">exit_status</span>  <span class="c1"># type: ignore</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_edited_files_with_context</span><span class="p">(</span><span class="n">patch</span><span class="o">=</span><span class="n">step_output</span><span class="o">.</span><span class="n">submission</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">"model_stats"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_step_to_trajectory</span><span class="p">(</span><span class="n">step_output</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_step_done</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">step_output</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">step_output</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="sweagent.agent.agents.DefaultAgent.run" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">run</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">run</span><span class="p">(</span><span class="n">env</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></span><span class="p">,</span> <span class="n">problem_statement</span><span class="p">:</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatement">ProblemStatement</span></span> <span class="o">|</span> <span class="n"><span title="sweagent.agent.problem_statement.ProblemStatementConfig">ProblemStatementConfig</span></span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="n"><span title="pathlib.Path">Path</span></span> <span class="o">=</span> <span class="n"><span title="pathlib.Path">Path</span></span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n"><span title="sweagent.types.AgentRunResult">AgentRunResult</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Run the agent on a problem instance. This method contains the
main loop that repeatedly calls <code>self._step</code> until the problem is solved.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>setup_args</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arguments to pass to the agent's setup method.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>env</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="            sweagent.environment.swe_env.SWEEnv" href="../env/#sweagent.environment.swe_env.SWEEnv">SWEEnv</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The environment to run the agent on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>traj_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to save the trajectory to</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>sweagent/agent/agents.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">SWEEnv</span><span class="p">,</span>
    <span class="n">problem_statement</span><span class="p">:</span> <span class="n">ProblemStatement</span> <span class="o">|</span> <span class="n">ProblemStatementConfig</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"."</span><span class="p">),</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AgentRunResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Run the agent on a problem instance. This method contains the</span>
<span class="sd">    main loop that repeatedly calls `self._step` until the problem is solved.</span>

<span class="sd">    Args:</span>
<span class="sd">        setup_args: Arguments to pass to the agent's setup method.</span>
<span class="sd">        env: The environment to run the agent on.</span>
<span class="sd">        traj_dir: Directory to save the trajectory to</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">,</span> <span class="n">problem_statement</span><span class="o">=</span><span class="n">problem_statement</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Run action/observation loop</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_run_start</span><span class="p">()</span>
    <span class="n">step_output</span> <span class="o">=</span> <span class="n">StepOutput</span><span class="p">()</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">step_output</span><span class="o">.</span><span class="n">done</span><span class="p">:</span>
        <span class="n">step_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_trajectory</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_chook</span><span class="o">.</span><span class="n">on_run_done</span><span class="p">(</span><span class="n">trajectory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Trajectory saved to </span><span class="si">%s</span><span class="s2">"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">traj_path</span><span class="p">)</span>

    <span class="c1"># Here we want to return the "global" information (e.g., submission should</span>
    <span class="c1"># be the best submission instead of the last one, etc.), so we get it from the traj file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trajectory_data</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">AgentRunResult</span><span class="p">(</span><span class="n">info</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"info"</span><span class="p">],</span> <span class="n">trajectory</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"trajectory"</span><span class="p">])</span>
</code></pre></div></td></tr></tbody></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>









  




                


<div class="floating-bubbles">
<div class="floating-bubbles-title">Our projects</div>
  <a href="https://mini-swe-agent.com/" class="bubble" title="Mini-SWE-Agent">
    <img src="../../assets/mini_logo.svg" alt="Mini-SWE-Agent">
    <span class="bubble-tooltip">Mini-SWE-Agent</span>
  </a>
  <a href="https://swe-rex.com/" class="bubble" title="SWE-rex">
    <img src="../../assets/swerex_logo.svg" alt="SWE-rex">
    <span class="bubble-tooltip">SWE-ReX</span>
  </a>
  <a href="https://swesmith.com" class="bubble" title="SWE-smith">
    <img src="../../assets/swesmith_logo.png" alt="SWE-smith">
    <span class="bubble-tooltip">SWE-smith</span>
  </a>
  <a href="https://swebench.com" class="bubble" title="SWE-bench">
    <img src="../../assets/swebench_logo.png" alt="SWE-bench">
    <span class="bubble-tooltip">SWE-bench</span>
  </a>
  <a href="https://www.swebench.com/sb-cli/" class="bubble" title="sb-cli">
    <img src="../../assets/sbcli_logo.svg" alt="sb-cli">
    <span class="bubble-tooltip">sb-cli</span>
  </a>
</div>

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../bundle_config/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Tool bundle config">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Tool bundle config
              </div>
            </div>
          </a>
        
        
          
          <a href="../env/" class="md-footer__link md-footer__link--next" aria-label="Next: Environment class">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Environment class
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.indexes", "navigation.top", "content.action.edit", "navigation.footer", "content.code.copy", "content.footnote.tooltips", "header.autohide", "announce.dismiss", "content.code.annotate", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../assets/js/sh-annotation.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html><!-- Floating Bubbles -->